{% extends 'dashboard_admin.html' %}
{% block dashboard_content %}
<h2>Alle koten</h2>
<div style="margin-bottom:10px;">
    <a href="{{ url_for('dashboard_admin_koten') }}"><button type="button">Ververs overzicht</button></a>
</div>
<p style="font-size:0.9rem; color:#555; margin-bottom:0;">
    Toeristenbelasting wordt automatisch berekend aan een vast tarief van {{ "%.0f"|format(tourist_tax_rate * 100) }}% van de totale omzet.
</p>
<style>
    .booking-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
    }
    .booking-table th,
    .booking-table td {
        border: 1px solid #ddd;
        padding: 0.5rem 0.75rem;
        text-align: left;
        vertical-align: top;
    }
    .booking-table th {
        color: #0057b8;
    }
    .booking-table thead {
        background-color: #f5f5f5;
    }
</style>
<table class="booking-table">
    <thead>
        <tr>
            <th>Adres</th>
            <th>Stad</th>
            <th>Eigenaar</th>
            <th>Capaciteit</th>
            <th>Foto</th>
            <th>Beschrijving</th>
            <th>Omzet per nacht</th>
            <th>Totale omzet</th>
            <th>Toeristenbelasting (tarief 6%)</th>
            <th>Omzet na toeristenbelasting</th>
            <th>Bewerk</th>
        </tr>
    </thead>
    <tbody>
        {% for kot in koten %}
            <tr>
                <td>{{ kot.adres }}</td>
                <td>{{ kot.stad }}</td>
                <td>
                    {% set eigenaar = None %}
                    {% if kot.kotbaas and kot.kotbaas.gebruiker %}
                        {% set eigenaar = kot.kotbaas.gebruiker %}
                    {% elif kot.student and kot.student.gebruiker %}
                        {% set eigenaar = kot.student.gebruiker %}
                    {% endif %}
                    {% if eigenaar %}
                        <strong>{{ eigenaar.naam }}</strong><br>
                        <span style="font-size:0.95em;">Email: {{ eigenaar.email or "n.v.t." }}</span><br>
                        <span style="font-size:0.95em;">Tel: {{ eigenaar.telefoon or "n.v.t." }}</span>
                    {% else %}
                        Onbekend
                    {% endif %}
                </td>
                <td>{{ kot.aantal_slaapplaatsen or 'n.v.t.' }}</td>
                {% set stats = kot_statistieken.get(kot.kot_id) if kot_statistieken else None %}
                <td>
                    {% if kot.foto %}
                        <img src="{{ kot.foto }}" width="80">
                    {% else %}
                        n.v.t.
                    {% endif %}
                </td>
                <td>{{ kot.beschrijving or 'n.v.t.' }}</td>
                <td>€ {{ "%.2f"|format(stats.omzet_per_nacht if stats else 0) }}</td>
                <td>€ {{ "%.2f"|format(stats.totale_omzet if stats else 0) }}</td>
                {% set tax_amount = stats.toeristenbelasting if stats else 0 %}
                {% set total_amount = stats.totale_omzet if stats else 0 %}
                <td>€ {{ "%.2f"|format(tax_amount) }}</td>
                <td>€ {{ "%.2f"|format(stats.omzet_na_belasting if stats else 0) }}</td>
                <td><a href="{{ url_for('admin_kot_edit', kot_id=kot.kot_id) }}"><button>Bewerk</button></a></td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
