<!doctype html>
<html>
<head>
    <title>Home / Koten Zoeken</title>
</head>
<body>
    <h1>Overzicht beschikbare koten</h1>
    <form method="get">
        <input type="text" name="stad" placeholder="Stad" value="{{ filters.stad }}">
        <input type="number" name="max_huur" placeholder="Max prijs per maand" value="{{ filters.max_huur }}">
        <input type="number" name="min_oppervlakte" placeholder="Min. oppervlakte m²" value="{{ filters.min_oppervlakte }}">
        <input type="number" name="aantal_slaapplaatsen" placeholder="Min. slaapplaatsen" value="{{ filters.aantal_slaapplaatsen }}">
        <input type="number" step="0.01" name="max_egwkosten" placeholder="Max EGW-kosten" value="{{ filters.max_egwkosten }}">

        <label>Startdatum</label>
        <input type="date" name="startdatum" value="{{ filters.startdatum }}">

        <label>Einddatum</label>
        <input type="date" name="einddatum" value="{{ filters.einddatum }}">
        
        <label>
            <input type="checkbox" name="brandveiligheidsconformiteit" value="1" {% if filters.brandveiligheidsconformiteit == '1' %}checked{% endif %}>
            Brandveilig conform
        </label>
        <label>
            <input type="checkbox" name="eigen_keuken" value="1" {% if filters.eigen_keuken == '1' %}checked{% endif %}>
            Eigen keuken
        </label>
        <label>
            <input type="checkbox" name="eigen_sanitair" value="1" {% if filters.eigen_sanitair == '1' %}checked{% endif %}>
            Eigen sanitair
        </label>
        <button type="submit">Filter toepassen</button>
        <a href="{{ url_for('index') }}">Filters wissen</a>
    </form>

    <h2>Actieve filters:</h2>
    <ul>
        {% set actieve = [] %}
        {% for fkey, fval in filters.items() if fval %}
            {% set _ = actieve.append(1) %}
            <li>
                {{ fkey|replace('_', ' ') }}: {{ fval }}
                <form method="get" style="display:inline">
                    {% for other_key, other_val in filters.items() if other_key != fkey and other_val %}
                        <input type="hidden" name="{{ other_key }}" value="{{ other_val }}">
                    {% endfor %}
                    <button type="submit" style="background:none;border:none;color:blue;text-decoration:underline;cursor:pointer;">verwijder</button>
                </form>
            </li>
        {% endfor %}
        {% if not actieve %}
            <li>Geen actieve filters</li>
        {% endif %}
    </ul>


    {% if koten %}
        <ul>
        {% for kot in koten %}
            <li>
                {{ kot.adres }}, {{ kot.stad }}<br>
                Oppervlakte: {{ kot.oppervlakte }} m²<br>
                Slaapplaatsen: {{ kot.aantal_slaapplaatsen }}<br>
                Prijs: €{{ kot.maandhuurprijs }}/maand, EGW: €{{ kot.egwkosten }}<br>
                Brandveilig: {{ 'ja' if kot.brandveiligheidsconformiteit else 'nee' }},
                Eigen keuken: {{ 'ja' if kot.eigen_keuken else 'nee' }},
                Eigen sanitair: {{ 'ja' if kot.eigen_sanitair else 'nee' }}<br>
                
                 {% if kot.beschikbaarheid and kot.beschikbaarheid|length > 0 %}
                     Startdatum: {{ kot.beschikbaarheid[0].startdatum.strftime("%d-%m-%Y") }}<br>
                     Einddatum: {{ kot.beschikbaarheid[0].einddatum.strftime("%d-%m-%Y") }}<br>
                {% else %}
                     <em>Geen beschikbaarheidsinformatie</em><br>
                {% endif %}
                <a href="{{ url_for('boek', kot_id=kot.kot_id) }}">Nu boeken</a>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p style="color: red;"><strong>Geen koten gevonden die aan uw voorwaarden voldoen.</strong></p>
    {% endif %}

    {% if session['gebruiker_id'] is defined %}
        <a href="{{ url_for('logout') }}">Uitloggen</a>
    {% else %}
        <a href="{{ url_for('login') }}">Login</a> /
        <a href="{{ url_for('register') }}">Registreer</a>
    {% endif %}

</body>
</html>

