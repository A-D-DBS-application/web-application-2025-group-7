<!doctype html>
<html>
<head>
    <title>Home / Koten Zoeken</title>
</head>
<body>
    <h1>Overzicht beschikbare koten</h1>
    <form method="get">
        <input type="text" name="stad" placeholder="Stad" value="{{ filters.stad }}">
        <input type="number" name="max_huur" placeholder="Max prijs per maand" value="{{ filters.max_huur }}" min="0">
        <input type="number" name="min_oppervlakte" placeholder="Min. oppervlakte m²" value="{{ filters.min_oppervlakte }}" min="0">
        <input type="number" name="aantal_slaapplaatsen" placeholder="Min. slaapplaatsen" value="{{ filters.aantal_slaapplaatsen }}" min="0">
        <input type="number" step="0.01" name="max_egwkosten" placeholder="Max EGW-kosten" value="{{ filters.max_egwkosten }}" min="0">

        <label>Startdatum</label>
        <input type="date" name="startdatum" value="{{ filters.startdatum }}">

        <label>Einddatum</label>
        <input type="date" name="einddatum" value="{{ filters.einddatum }}">
        
        <label>
            <input type="checkbox" name="brandveiligheidsconformiteit" value="1" {% if filters.brandveiligheidsconformiteit == '1' %}checked{% endif %}>
            Brandveilig conform
        </label>
        <label>
            <input type="checkbox" name="eigen_keuken" value="1" {% if filters.eigen_keuken == '1' %}checked{% endif %}>
            Eigen keuken
        </label>
        <label>
            <input type="checkbox" name="eigen_sanitair" value="1" {% if filters.eigen_sanitair == '1' %}checked{% endif %}>
            Eigen sanitair
        </label>
        <button type="submit">Filter toepassen</button>
        <a href="{{ url_for('index') }}">Filters wissen</a>
    </form>

    <h2>Actieve filters:</h2>
    <ul>
        {% set actieve = [] %}
        {% for fkey, fval in filters.items() if fval %}
            {% set _ = actieve.append(1) %}
            <li>
                {{ fkey|replace('_', ' ') }}: {{ fval }}
                <form method="get" style="display:inline">
                    {% for other_key, other_val in filters.items() if other_key != fkey and other_val %}
                        <input type="hidden" name="{{ other_key }}" value="{{ other_val }}">
                    {% endfor %}
                    <button type="submit" style="background:none;border:none;color:blue;text-decoration:underline;cursor:pointer;">verwijder</button>
                </form>
            </li>
        {% endfor %}
        {% if not actieve %}
            <li>Geen actieve filters</li>
        {% endif %}
    </ul>


    {% if koten %}
        <ul>
        {% for kot in koten %}
            <li>
                {{ kot.adres }}, {{ kot.stad }}<br>
                Oppervlakte: {{ kot.oppervlakte }} m²<br>
                Slaapplaatsen: {{ kot.aantal_slaapplaatsen }}<br>
                Prijs: €{{ kot.maandhuurprijs }}/maand, EGW: €{{ kot.egwkosten }}<br>
                Brandveilig: {{ 'ja' if kot.brandveiligheidsconformiteit else 'nee' }},
                Eigen keuken: {{ 'ja' if kot.eigen_keuken else 'nee' }},
                Eigen sanitair: {{ 'ja' if kot.eigen_sanitair else 'nee' }}<br>
                {% if kot.foto %}
                    <img src="{{ kot.foto }}" alt="Foto van kot" style="max-width:200px; height:auto; display:block; margin:8px 0;">
                {% endif %}
                {% if kot.beschrijving %}
                    <p>{{ kot.beschrijving }}</p>
                {% endif %}
                
                {% if session.get('rol') == 'admin' %}
                    <div style="margin:8px 0; padding:8px; border:1px dashed #aaa;">
                        <strong>Admin acties</strong>
                        <form method="post" action="{{ url_for('admin_update_description', kot_id=kot.kot_id) }}" style="margin-top:6px;">
                            <label>Beschrijving toevoegen/bijwerken:</label><br>
                            <textarea name="beschrijving" rows="3" style="width:100%;">{{ kot.beschrijving or '' }}</textarea>
                            <button type="submit">Opslaan beschrijving</button>
                        </form>
                        <form method="post" action="{{ url_for('admin_update_photo', kot_id=kot.kot_id) }}" style="margin-top:6px;">
                            <label>Foto-URL toevoegen/bijwerken:</label>
                            <input type="text" name="foto" value="{{ kot.foto or '' }}" style="width:100%;">
                            <button type="submit">Opslaan foto</button>
                        </form>
                    </div>
                {% endif %}

                {% if kot.beschikbaarheden %}
                {% for b in kot.beschikbaarheden %}
                    Startdatum: {{ b.startdatum.strftime('%Y-%m-%d') }}<br>
                    Einddatum: {{ b.einddatum.strftime('%Y-%m-%d') }}<br>
                 {% endfor %}
                {% else %}
                    Geen beschikbaarheidsinformatie
                {% endif %}
                <a href="{{ url_for('boek', kot_id=kot.kot_id) }}">Nu boeken</a>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p style="color: red;"><strong>Geen koten gevonden die aan uw voorwaarden voldoen.</strong></p>
    {% endif %}

    {% if session['gebruiker_id'] is defined or session.get('rol') == 'admin' %}
        <a href="{{ url_for('logout') }}">Uitloggen</a>
    {% else %}
        <a href="{{ url_for('login') }}">Login</a> /
        <a href="{{ url_for('register') }}">Registreer</a>
    {% endif %}

</body>
</html>

