<!doctype html>
<html>
<head>
    <title>Koten Zoeken</title>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cards.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/forms.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages.css') }}">
    
</head>

<body>

<header>
    <div class="logo-badge">
        <img src="{{ url_for('static', filename='uploads/logo_gitoo_transparant.png') }}"
            alt="Gitoo logo">
    </div>
    
    <div class="auth-links" style="position:absolute; right:20px; top:50px;">
        {% if session.get('gebruiker_id') or session.get('rol') == 'admin' %}
            {% if session.get('rol') %}
                {% set rol = session.get('rol') %}
                {% if rol == 'admin' %}
                    {% set rol_route = url_for('dashboard_admin') %}
                {% elif rol == 'kotbaas' %}
                    {% set rol_route = url_for('dashboard_kotbaas') %}
                {% else %}
                    {% set rol_route = url_for('dashboard') %}
                {% endif %}
                <a href="{{ rol_route }}">{{ rol|capitalize }}</a>
            {% endif %}
            <a href="{{ url_for('logout') }}">Uitloggen</a>
        {% else %}
            <a href="{{ url_for('login') }}">Login</a>
            <a href="{{ url_for('register') }}">Registreer</a>
        {% endif %}
    </div>
</header>

<div class="container">

    <!-- FILTERS -->
    <div class="filter-box">
        <form method="get">
            <input type="text" name="stad" placeholder="Stad" value="{{ filters.stad }}">
            <input type="number" name="max_huur" placeholder="Max huur (€)" value="{{ filters.max_huur }}" min="0">
            <input type="number" name="min_oppervlakte" placeholder="Min m²" value="{{ filters.min_oppervlakte }}" min="0">
            <input type="number" name="aantal_slaapplaatsen" placeholder="Slaapplaatsen" value="{{ filters.aantal_slaapplaatsen }}" min="0">
            <input type="number" step="0.01" name="max_egwkosten" placeholder="Max EGW (€)" value="{{ filters.max_egwkosten }}" min="0">

            <br><br>

            <label>Startdatum:</label>
            <input type="date" name="startdatum" value="{{ filters.startdatum }}">

            <label>Einddatum:</label>
            <input type="date" name="einddatum" value="{{ filters.einddatum }}">

            <br><br>

            <label><input type="checkbox" name="eigen_keuken" value="1" {% if filters.eigen_keuken == '1' %}checked{% endif %}> Eigen keuken</label>
            <label><input type="checkbox" name="eigen_sanitair" value="1" {% if filters.eigen_sanitair == '1' %}checked{% endif %}> Eigen sanitair</label>

            <br><br>

            <button class="btn" type="submit">Toepassen</button>
            <a class="btn" href="{{ url_for('index') }}" style="background:#e0e0e0; color:black;">Wissen</a>
        </form>
    </div>

    <!-- RESULTATEN -->
    {% if koten %}
    <div class="kot-grid">
        {% for kot in koten %}
        <div class="kot-card">

            {% if kot.foto %}
                <img src="{{ kot.foto }}" alt="Foto van kot">
            {% else %}
                <img src="https://via.placeholder.com/600x400?text=Geen+Foto" alt="Geen foto">
            {% endif %}

            <div class="kot-info">

                <div class="kot-title">{{ kot.adres }}</div>
                <div class="kot-location">{{ kot.stad }}</div>

                <div class="kot-details">{{ kot.oppervlakte }} m² • {{ kot.aantal_slaapplaatsen }} slaapplaatsen</div>

                <div class="price-tag">Vanaf €{{ kot.maandhuurprijs|format_currency }}/maand</div>

                {% if kot.beschrijving %}
                    <p style="margin-top:10px;">{{ kot.beschrijving }}</p>
                {% endif %}

                {% if kot.beschikbaarheden %}
                    {% for b in kot.beschikbaarheden %}
                        <p><strong>Beschikbaar:</strong> {{ b.startdatum.strftime('%d/%m/%Y') }} → {{ b.einddatum.strftime('%d/%m/%Y') }}</p>
                    {% endfor %}
                {% endif %}

                <a class="book-btn" href="{{ url_for('boek', kot_id=kot.kot_id) }}">Nu boeken</a>
            </div>
        </div>
        {% endfor %}
    </div>

    {% else %}
        <p style="color:red; font-size:18px;">Geen koten gevonden.</p>
    {% endif %}

</div>

</body>
</html>
