{% extends 'dashboard_admin.html' %}
{% block dashboard_content %}

<h2 style="color:#003b95; margin-top:0; text-align:center;">Alle boekingen</h2>

<style>
    /* Tabel in moderne kaart-stijl */
    .booking-wrapper { 
        width: 100%;
        margin: 0;
        overflow-x: auto;
        border-radius: 16px;
        padding-bottom: 6px;
    }
    .booking-table {
        width: 100%;
        min-width: 1100px;
        border-collapse: separate;
        border-spacing: 0;
        margin-top: 1rem;
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 25px 40px rgba(0,0,0,0.08);
        table-layout: auto;
        border: 1px solid rgba(0,59,149,0.12);
    }

    .booking-table thead {
        background: linear-gradient(135deg, #f0f6ff, #dfe9ff);
    }

    .booking-table th {
        padding: 16px 20px;
        font-weight: 700;
        color: #002a70;
        border-bottom: 1px solid rgba(0,59,149,0.15);
        white-space: nowrap;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        font-size: 0.85rem;
    }

    .booking-table td {
        padding: 14px 20px;
        border-bottom: 1px solid #e6e6e6;
        color: #2f2f2f;
        white-space: nowrap;
    }

    .booking-table tbody tr:nth-child(even) {
        background: #f9fbff;
    }

    .booking-table tbody tr:hover {
        background: #eef5ff;
    }

    .booking-table tr:last-child td {
        border-bottom: none;
    }

    .booking-table tbody tr.cancelled {
        background: #fff5f5;
    }

    .booking-table tbody tr.cancelled td {
        color: #8a1f1f;
    }

    .booking-table td.actions {
        text-align: center;
        white-space: nowrap;
    }

    .btn-danger-small {
        background: #c62828;
        border: none;
        color: #fff;
        padding: 8px 14px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
    }

    .btn-danger-small:hover {
        background: #a71d1d;
    }

    .btn-danger-small:disabled {
        background: #d6d6d6;
        color: #777;
        cursor: not-allowed;
    }

    .actions form {
        margin: 0;
    }

    .status-chip {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        margin-left: 8px;
    }

    .status-chip.cancelled {
        background: rgba(198,40,40,0.12);
        color: #9c1f1f;
    }

    .search-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
        margin: 15px 0;
    }

    .search-bar form {
        display: flex;
        gap: 10px;
        flex: 1;
    }

    .search-bar input[type="text"] {
        flex: 1;
        padding: 10px 14px;
        border-radius: 10px;
        border: 1px solid #cfd8ea;
    }

    .btn-secondary {
        background: #e0e0e0;
        border: none;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        color: #003b95;
    }

    .btn-secondary:hover {
        background: #d0d0d0;
    }
</style>

<div class="search-bar">
    <form action="{{ url_for('dashboard_admin') }}" method="get">
        <input type="text"
               name="zoekterm"
               placeholder="Zoek op huurder, email, telefoon, adres, stadâ€¦"
               value="{{ zoekterm }}">
        <button type="submit" class="btn-primary">Zoeken</button>
        {% if zoekterm %}
            <a href="{{ url_for('dashboard_admin') }}" class="btn-secondary" style="text-decoration:none; display:flex; align-items:center;">Wissen</a>
        {% endif %}
    </form>
    <form action="{{ url_for('dashboard_admin') }}" method="get">
        <button type="submit" class="btn-primary" style="white-space:nowrap;">Ververs overzicht</button>
    </form>
</div>

<div class="booking-wrapper">
<table class="booking-table">
    <thead>
        <tr>
            <th>Huurder</th>
            <th>Email</th>
            <th>Telefoon</th>
            <th>Kot</th>
            <th>Aantal personen</th>
            <th>Voorkeuren/Opmerkingen</th>
            <th>Status</th>
            <th>Periode</th>
            <th>Acties</th>
        </tr>
    </thead>

    <tbody>
        {% for boeking in boekingen %}
            {% set huurder = boeking.huurder if boeking.huurder else None %}
            {% set gebruiker = boeking.huurder.gebruiker if boeking.huurder else None %}
            {% set is_cancelled = boeking.status_boeking and 'geannuleerd' in boeking.status_boeking.lower() %}

            <tr class="{% if is_cancelled %}cancelled{% endif %}">
                <td>{{ gebruiker.naam if gebruiker else 'n.v.t.' }}</td>
                <td>{{ gebruiker.email if gebruiker else 'n.v.t.' }}</td>

                <td>
                    {% if gebruiker and gebruiker.telefoon %}
                        {{ gebruiker.telefoon | format_phone }}
                    {% else %}
                        n.v.t.
                    {% endif %}
                </td>

                <td>
                    {{ boeking.kot.adres if boeking.kot else 'n.v.t.' }},
                    {{ boeking.kot.stad if boeking.kot else '' }}
                </td>

                <td>{{ boeking.aantal_personen }}</td>
                <td>{{ huurder.voorkeuren if huurder and huurder.voorkeuren else 'n.v.t.' }}</td>
                <td>
                    {{ boeking.status_boeking }}
                    {% if is_cancelled %}
                        <span class="status-chip cancelled">Geannuleerd</span>
                    {% endif %}
                </td>

                {% set start = boeking.startdatum %}
                {% set eind = boeking.einddatum %}

                <td>
                    {% if start or eind %}
                        {% set start_str = start.strftime('%Y-%m-%d') if start else 'n.v.t.' %}
                        {% set eind_str = eind.strftime('%Y-%m-%d') if eind else 'n.v.t.' %}
                        {{ start_str }} t.e.m. {{ eind_str }}

                        {% if start and eind %}
                            {% set dagen = (eind - start).days %}
                            {% if dagen < 1 %}{% set dagen = 1 %}{% endif %}
                            ({{ dagen }} dagen)
                        {% endif %}
                    {% else %}
                        n.v.t.
                    {% endif %}
                </td>
                <td class="actions">
                    <form action="{{ url_for('admin_delete_boeking', boeking_id=boeking.boeking_id) }}"
                          method="post"
                          onsubmit="return confirm('Boeking annuleren?');">
                        <button type="submit"
                                class="btn-danger-small"
                                {% if is_cancelled %}disabled{% endif %}>
                            {% if is_cancelled %}Geannuleerd{% else %}Annuleer{% endif %}
                        </button>
                    </form>
                </td>
            </tr>

        {% else %}
            <tr><td colspan="9" style="text-align:center; padding:20px;">Geen boekingen gevonden.</td></tr>
        {% endfor %}
    </tbody>
 </table>
</div>

{% endblock %}
